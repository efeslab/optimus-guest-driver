CC=gcc
CFLAGS=-DHAVE_MORECORE=0 -DMALLOC_ALIGNMENT=64 -DDEFAULT_MMAP_THRESHOLD=MAX_SIZE_T -DMMAP_RESERVE_VMSPACE_SIZE="(1L<<36)" -DUSE_LOCKS=1 -Wall
LIBOPTFLAGS=-O1
PREFIX?=.
DLMALLOC_SO=${PREFIX}/libdlmalloc.so
DLMALLOC_O=${PREFIX}/libdlmalloc.o
#-DDEFAULT_TRIM_THRESHOLD=MAX_SIZE_T
all: ${DLMALLOC_SO} ${DLMALLOC_O}

${DLMALLOC_SO}: malloc.c
	${CC} ${CFLAGS} ${LIBOPTFLAGS} -shared -fPIC $< -o $@
${DLMALLOC_O}: malloc.c
	${CC} -DUSE_DL_PREFIX ${CFLAGS} ${LIBOPTFLAGS} -c $< -o $@
clean:
	rm -rf ${DLMALLOC_SO} ${DLMALLOC_O}
